#!/bin/bash
set -uexo pipefail

# Yeet firstboot service entirely, otherwise systemd.firstboot=false needs
# to be added to kernel commandline.
rm /usr/lib/systemd/system/systemd-firstboot.service

rm -rf /usr/lib/modules/*/vmlinuz
rm -rf /usr/lib/modules/*/dtb

# ??? Where is this coming from?!
rm -rf /boot/fedora

mkdir -p /usr/lib/firmware/updates/
cp -R $SRCDIR/firmware-oneplus-sdm845/lib/firmware/postmarketos/* /usr/lib/firmware/updates/
cp -R $SRCDIR/firmware-oneplus-sdm845/lib/firmware/qcom /usr/lib/firmware/
cp -R $SRCDIR/firmware-oneplus-sdm845/lib/firmware/qca /usr/lib/firmware/
rm -rf /usr/lib/firmware/qcom/sdm845/oneplus6/modem_pr/
